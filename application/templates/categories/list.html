{% extends "layout.html" %}

{% block body %}
  <table>
    <tr>
      <th>{{ form.name.label }}</th>
      <th>{{ form.description.label }}</th>
    </tr>

    {% for category in categories %}
    <tr>
      <td>{{ category.name }}</td>
      <td>{{ category.description }}</td>

      <td>
        <button id="edit-button-{{ category.id }}" class="edit" onclick="show_edit({{ category.id }})">
          Edit / Delete
        </button>
      </td>

      <td>
        <div style="display: none" id="edit-{{ category.id }}" class="edit">
          <form method="POST" action="{{ url_for('categories_edit', category_id=category.id) }}">
            <table>
              <tr>
                <td>{{ form.name.label }}</td>
                <td>{{ form.name }}</td>
                <td>
                  <ul>
                  {% for error in form.name.errors %}
                    <li>{{ error }}</li>
                  {% endfor %}
                  </ul>
                </td>
              </tr>
              <tr>
                <td>{{ form.description.label }}</td>
                <td>{{ form.description }}</td>
                <td>
                  <ul>
                  {% for error in form.description.errors %}
                    <li>{{ error }}</li>
                  {% endfor %}
                  </ul>
                </td>
              </tr>
            </table>

            <input type="submit" value="Save"/>
          </form>

          <form method="POST" action="{{ url_for('categories_delete', category_id=category.id) }}">
            <input type="submit" value="Delete"/>
          </form>

        </div>
      </td>
    </tr>
    {% endfor %}

  </table>
  <script>
      function show_edit(id) {
          const e = document.getElementById(`edit-${id}`);
          const eClasses = document.getElementsByClassName(`edit`);

          if (e.style.display === "none") {
              for (const eClass of eClasses) {
                  eClass.style.display = "none";
              }

              document.getElementById(`edit-button-${id}`).style.display = 'Block';
              document.getElementById(`edit-button-${id}`).innerText = 'Cancel';
              e.style.display = "block";
          } else {
              document.getElementById(`edit-button-${id}`).innerText = 'Edit / Delete';
              e.style.display = "none";
              document.body.innerHTML += '<form id="cancel-edit" action="{{ url_for('categories_index')}}" ' +
                  'method="post"><input type="hidden"></form>';
              document.getElementById("cancel-edit").submit();
          }
      }
  </script>
{% endblock %}
